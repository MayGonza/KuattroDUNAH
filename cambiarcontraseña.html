HTML:

<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cambiar Contrase√±a</title>
    <link rel="stylesheet" href="public/css/styles_cambiarPassword.css">
</head>

<body>

    <!-- Encabezado con logo -->
    <header class="navbar">
        <div class="navbar-container">
            <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
            <a href="inicio.html" class="nav-logo">
                <img src="https://kuattro.hn/wp-content/uploads/2019/03/Logo_Kuattro_VFinal_Flat-1.png" alt="Logo"
                    class="nav-logo-img">
            </a>

            <div class="user-menu">
                <button class="user-button" onclick="toggleUserMenu()">üë§</button>
                <div class="user-dropdown" id="userDropdown">
                    <a href="perfil_recurso.html">Perfil</a>
                    <a href="cambiarcontrase√±a.html">Cambiar contrase√±a</a>
                    <a href="index.html">Cerrar Sesi√≥n</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Men√∫ lateral -->
    <aside class="side-menu" id="sideMenu">
        <nav>
            <ul>
                <li><a href="solicitudes.html">Solicitudes</a></li>
                <li><a href="Usuarios.html">Usuarios</a></li>
                <li><a href="empleado.html">Empleado</a></li>
                <li class="has-submenu">
                    <a href="#" onclick="toggleSubMenu(event)">
                        Seguridad 
                        <span class="arrow">‚ñº</span>
                    </a>
                    <ul class="submenu">
                        <li><a href="parametros.html">Par√°metros</a></li>
                        <li><a href="usuarioyseguridad.html">Roles y Permisos</a></li>
                    </ul>
                </li>
                <li class="has-submenu">
                    <a href="#" onclick="toggleSubMenu(event)">
                        Mantenimiento 
                        <span class="arrow">‚ñº</span>
                    </a>
                    <ul class="submenu">
                        <li><a href="backup.html">Respaldo y Restauraci√≥n</a></li>
                        <li><a href="bitacora.html">Bit√°cora</a></li>
                    </ul>
                    <li><a href="nosotros.html">Nosotros</a></li>
                <li><a href="contacto.html">Contacto</a></li>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Todo lo que vayan a agregar -->
    <main class="main-content" id="mainContent">
        <!-- Contenedor principal -->
        <div class="form-container">

            <!-- Formulario de solicitud de vacaciones -->
            <form id="passwordsForm">
                <h2>Cambiar Contrase√±a</h2>
                <hr />

                <div class="password-container">
                    <input type="password" id="actualPassword" name="actualPassword" required
                        placeholder="Contrase√±a actual" />
                    <div id="eyeIcon1" class="eye-icon">
                        <img src="public/imagenes/noMostrar.png" alt="Ver contrase√±a" id="eyeImage1">
                    </div>
                </div>
                <div id="passwordMatchMessage"></div>

                <div class="password-container">
                    <input type="password" id="nuevaPassword" name="nuevaPassword" required
                        placeholder="Contrase√±a nueva" />
                    <div id="eyeIcon2" class="eye-icon">
                        <img src="public/imagenes/noMostrar.png" alt="Ver contrase√±a" id="eyeImage2">
                    </div>
                </div>

                <div id="passwordRequerimientos" class="requirements">
                    <ul>
                        <li id="lengthRequirement">Debe tener al menos 8 caracteres.</li>
                        <li id="uppercaseRequirement">Debe contener al menos una letra may√∫scula.</li>
                        <li id="lowercaseRequirement">Debe contener al menos una letra min√∫scula.</li>
                        <li id="digitRequirement">Debe contener al menos un n√∫mero.</li>
                        <li id="specialCharRequirement">Debe contener al menos un car√°cter especial (Ej: @, $, %, etc.).
                        </li>
                    </ul>
                </div>

                <div class="password-container">
                    <input type="password" id="confirmacionPassword" name="confirmacionPassword" required
                        placeholder="Confirma tu contrase√±a" />
                    <div id="eyeIcon3" class="eye-icon">
                        <img src="public/imagenes/noMostrar.png" alt="Ver contrase√±a" id="eyeImage3">
                    </div>
                </div>
                <div id="confirmPasswordMatchMessage"></div>

                <!-- Bot√≥n de env√≠o -->
                <div class="botones">
                    <button type="submit" id="saveButton" class="saveBtn">Guardar</button>
                    <button class="cancelBtn" onclick="window.history.back()">Cancelar</button>
                </div>
            </form>
        </div>
    </main>

    <script>
        function toggleMenu() {
            const sideMenu = document.getElementById('sideMenu');
            const mainContent = document.getElementById('mainContent');
            sideMenu.classList.toggle('open');
            mainContent.classList.toggle('shifted');
        }
        function toggleUserMenu() {
            const userDropdown = document.getElementById('userDropdown');
            userDropdown.classList.toggle('show');
        }

        window.onclick = function (event) {
            if (!event.target.matches('.user-button')) {
                const dropdowns = document.getElementsByClassName('user-dropdown');
                for (let i = 0; i < dropdowns.length; i++) {
                    const openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }

        // VALIDACI√ìN DE LOS INPUTS
        // Variables
        const currentPasswordInput = document.getElementById("actualPassword");
        const newPasswordInput = document.getElementById("nuevaPassword");
        const confirmPasswordInput = document.getElementById("confirmacionPassword");
        const passwordMatchMessage = document.getElementById("passwordMatchMessage");
        const passwordRequirements = document.getElementById("passwordRequerimientos");
        const confirmPasswordMatchMessage = document.getElementById("confirmPasswordMatchMessage");
        const lengthRequirement = document.getElementById("lengthRequirement");
        const uppercaseRequirement = document.getElementById("uppercaseRequirement");
        const lowercaseRequirement = document.getElementById("lowercaseRequirement");
        const digitRequirement = document.getElementById("digitRequirement");
        const specialCharRequirement = document.getElementById("specialCharRequirement");
        const eyeIcon1 = document.getElementById("eyeIcon1");
        const eyeImage1 = document.getElementById("eyeImage1");
        const eyeIcon2 = document.getElementById("eyeIcon2");
        const eyeImage2 = document.getElementById("eyeImage2");
        const eyeIcon3 = document.getElementById("eyeIcon3");
        const eyeImage3 = document.getElementById("eyeImage3");
        const formulario = document.getElementById('passwordsForm');

        // Cambiar tipo y imagen para la contrase√±a actual
        eyeIcon1.addEventListener("click", function () {
            if (currentPasswordInput.type === "password") {
                currentPasswordInput.type = "text";  // Mostrar la contrase√±a
                eyeImage1.src = "public/imagenes/mostrar.png";  // Cambiar imagen a "mostrar"
            } else {
                currentPasswordInput.type = "password";  // Ocultar la contrase√±a
                eyeImage1.src = "public/imagenes/noMostrar.png";  // Cambiar imagen a "no mostrar"
            }
        });

        // Cambiar tipo y imagen para la contrase√±a nueva
        eyeIcon2.addEventListener("click", function () {
            if (newPasswordInput.type === "password") {
                newPasswordInput.type = "text";  // Mostrar la contrase√±a
                eyeImage2.src = "public/imagenes/mostrar.png";  // Cambiar imagen a "mostrar"
            } else {
                newPasswordInput.type = "password";  // Ocultar la contrase√±a
                eyeImage2.src = "public/imagenes/noMostrar.png";  // Cambiar imagen a "no mostrar"
            }
        });

        // Cambiar tipo y imagen para la confirmaci√≥n de contrase√±a
        eyeIcon3.addEventListener("click", function () {
            if (confirmPasswordInput.type === "password") {
                confirmPasswordInput.type = "text";  // Mostrar la contrase√±a
                eyeImage3.src = "public/imagenes/mostrar.png";  // Cambiar imagen a "mostrar"
            } else {
                confirmPasswordInput.type = "password";  // Ocultar la contrase√±a
                eyeImage3.src = "public/imagenes/noMostrar.png";  // Cambiar imagen a "no mostrar"
            }
        });

        // Muestra los requisitos de contrase√±a nueva cuando el input recibe foco
        newPasswordInput.addEventListener("focus", function () {
            passwordRequirements.style.display = "block";
        });

        // Oculta los requisitos de contrase√±a nueva cuando el input pierde el foco
        newPasswordInput.addEventListener("blur", function () {
            passwordRequirements.style.display = "none";
        });

        // Validaci√≥n en tiempo real de la contrase√±a nueva
        newPasswordInput.addEventListener("input", function () {
            const password = newPasswordInput.value;

            const minLength = 8;
            const hasUpperCase = /[A-Z]/.test(password);
            const hasLowerCase = /[a-z]/.test(password);
            const hasDigit = /\d/.test(password);
            const hasSpecialChar = /[^a-zA-Z0-9\s]/.test(password); // Car√°cter especial: cualquier cosa que no sea letra o n√∫mero

            // Longitud m√≠nima
            if (password.length >= minLength) {
                lengthRequirement.classList.add("valid");
                lengthRequirement.classList.remove("invalid");
            } else {
                lengthRequirement.classList.add("invalid");
                lengthRequirement.classList.remove("valid");
            }

            // May√∫scula
            if (hasUpperCase) {
                uppercaseRequirement.classList.add("valid");
                uppercaseRequirement.classList.remove("invalid");
            } else {
                uppercaseRequirement.classList.add("invalid");
                uppercaseRequirement.classList.remove("valid");
            }

            // Min√∫scula
            if (hasLowerCase) {
                lowercaseRequirement.classList.add("valid");
                lowercaseRequirement.classList.remove("invalid");
            } else {
                lowercaseRequirement.classList.add("invalid");
                lowercaseRequirement.classList.remove("valid");
            }

            // N√∫mero
            if (hasDigit) {
                digitRequirement.classList.add("valid");
                digitRequirement.classList.remove("invalid");
            } else {
                digitRequirement.classList.add("invalid");
                digitRequirement.classList.remove("valid");
            }

            // Car√°cter especial
            if (hasSpecialChar) {
                specialCharRequirement.classList.add("valid");
                specialCharRequirement.classList.remove("invalid");
            } else {
                specialCharRequirement.classList.add("invalid");
                specialCharRequirement.classList.remove("valid");
            }
        });

        // Ocultar el mensaje de coincidencia de confirma tu contrase√±a cuando el campo pierde el foco
        confirmPasswordInput.addEventListener("blur", function () {
            confirmPasswordMatchMessage.style.display = "none"; // Ocultar el mensaje cuando el campo pierde foco
        });

        // Verificar si el nombre de usuario ya existe
        // Asociar la misma funci√≥n a los eventos 'focus' e 'input'
        confirmPasswordInput.addEventListener("input", confirmInputFocus);  // Cuando el usuario empieza a escribir
        confirmPasswordInput.addEventListener("focus", confirmInputFocus);  // Cuando el campo recibe el foco

        // Funci√≥n que se ejecuta tanto cuando el campo nombre de usuario recibe el foco o cuando se escribe
        function confirmInputFocus() {
            confirmPasswordMatchMessage.style.display = "block";

            if (confirmPasswordInput.value !== newPasswordInput.value) {
                confirmPasswordMatchMessage.textContent = "Las contrase√±as no coinciden";
                confirmPasswordMatchMessage.classList.remove("password-match");
                confirmPasswordMatchMessage.classList.add("password-mismatch");
            } else {
                confirmPasswordMatchMessage.textContent = "Las contrase√±as coinciden";
                confirmPasswordMatchMessage.classList.remove("password-mismatch");
                confirmPasswordMatchMessage.classList.add("password-match");
            }
        };

        // Prevenir copiar en los campos de contrase√±a actual, nueva y confirmacion de contrase√±a
        currentPasswordInput.addEventListener("copy", function (event) {
            event.preventDefault(); // Evita la acci√≥n de copiar
        });

        newPasswordInput.addEventListener("copy", function (event) {
            event.preventDefault(); // Evita la acci√≥n de copiar
        });

        confirmPasswordInput.addEventListener("copy", function (event) {
            event.preventDefault(); // Evita la acci√≥n de copiar
        });

        // Prevenir pegar en los campos de contrase√±a actual, nueva y confirmacion contrase√±a
        currentPasswordInput.addEventListener("paste", function (event) {
            event.preventDefault(); // Evita la acci√≥n de pegar
        });

        newPasswordInput.addEventListener("paste", function (event) {
            event.preventDefault(); // Evita la acci√≥n de pegar
        });

        confirmPasswordInput.addEventListener("paste", function (event) {
            event.preventDefault(); // Evita la acci√≥n de pegar
        });


        
        // VALIDACI√ìN CON EL BACKEND
        // Verificaci√≥n de la coincidencia de la contrase√±a actual
        currentPasswordInput.addEventListener("input", function () {
            const data = { contraActual: document.getElementById("actualPassword").value };

            fetch('http://localhost:3000/verificar_contra', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then((response) => response.json())
                .then((data) => {
                    if (!data) {
                        passwordMatchMessage.textContent = "La contrase√±a actual no es correcta.";
                        passwordMatchMessage.style.color = "red";
                        passwordMatchMessage.style.display = "block";
                        document.getElementById("saveButton").disabled = true;
                    } else {
                        passwordMatchMessage.style.display = "none";
                        document.getElementById("saveButton").disabled = false;
                    }
                })
                .catch((error) => console.error(error));
        });


        // Enviar las contrase√±as al servidor
        formulario.addEventListener('submit', function (event) {
            let valid = true;

            // Validaci√≥n de la nueva contrase√±a
            const password = newPasswordInput.value;
            const minLength = 8;
            const hasUpperCase = /[A-Z]/.test(password);
            const hasLowerCase = /[a-z]/.test(password);
            const hasDigit = /\d/.test(password);
            const hasSpecialChar = /[^a-zA-Z0-9\s]/.test(password);

            if (password.length < minLength || !hasUpperCase || !hasLowerCase || !hasDigit || !hasSpecialChar) {
                newPasswordInput.focus(); // Mueve el cursor al campo de contrase√±a si no cumple los requisitos
                valid = false;
            }

            // Validaci√≥n de la confirmaci√≥n de la contrase√±a
            if (confirmPasswordInput.value !== password) {
                confirmPasswordInput.focus(); // Mueve el cursor al campo de confirmaci√≥n de contrase√±a si no coinciden
                valid = false;
            }

            // Si alg√∫n campo es inv√°lido, se evita el env√≠o del formulario
            if (!valid) {
                event.preventDefault(); // Evita el env√≠o del formulario
                return; // Detenemos la ejecuci√≥n aqu√≠
            }

            // Si todo es v√°lido, procedemos a enviar la informaci√≥n
            event.preventDefault(); // Prevenimos el env√≠o est√°ndar del formulario
            const formData = new FormData(this);
            const data = { contrase√±a: document.getElementById("nuevaPassword").value };

            fetch('http://localhost:3000/cambiar_contra', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Contrase√±a cambiada:', data);

                    // Crear el contenedor del mensaje de √©xito flotante
                    const successMessage = document.createElement("div");
                    successMessage.classList.add("toast-message");

                    // Crear la imagen del √≠cono de check
                    const checkIcon = document.createElement("img");
                    checkIcon.src = "public/imagenes/check.png"; // Aseg√∫rate de poner la ruta correcta de la imagen
                    checkIcon.alt = "Check icon"; // Descripci√≥n alternativa para accesibilidad

                    // Agregar la imagen antes del texto del mensaje
                    successMessage.appendChild(checkIcon);

                    // Agregar el texto del mensaje
                    successMessage.appendChild(document.createTextNode("¬°Contrase√±a guardada exitosamente!"));

                    // Agregar la clase "toast-message" para estilizarlo
                    document.body.appendChild(successMessage);

                    // Desaparecer el mensaje
                    setTimeout(function () {
                        successMessage.style.opacity = "0";  // Desvanecer el mensaje
                        setTimeout(function () {
                            successMessage.remove();  // Eliminar el mensaje del DOM
                        }, 500);  // Esperar el tiempo de la transici√≥n antes de eliminar
                        
                        // Redirigir a otra p√°gina despu√©s de que el mensaje desaparezca
                        window.location.href = "inicio.html"; // Redirigir a la p√°gina de login
                    }, 2500);  // El mensaje desaparecer√° despu√©s de 2.5 segundos
                })
                .catch((error) => console.error('Error:', error));
        });

        function toggleSubMenu(event) {
    event.preventDefault(); // Evita la navegaci√≥n predeterminada
    let parentLi = event.target.closest('.has-submenu'); // Encuentra el elemento padre <li>
    let submenu = parentLi.querySelector('.submenu');
    let arrow = parentLi.querySelector('.arrow');

    if (submenu) {
        submenu.classList.toggle('active'); // Alterna visibilidad del men√∫
        parentLi.classList.toggle('open'); // Agrega la clase para rotar la flecha
    }
}
    </script>

    <!-- Pie de p√°gina com√∫n -->
    <footer class="footer">
        <p>&copy; Kuattro Distribuciones. Todos los derechos reservados.</p>
    </footer>
</body>

</html>